<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ÿ™ÿ™ÿ®ÿπ ÿ∑ŸÑÿ®ÿßÿ™ŸÉ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©">
    <meta name="theme-color" content="#f97316">
    <title id="pageTitle">ÿ∑ŸÑÿ®ÿßÿ™Ÿä</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìã</text></svg>">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-icon rocket-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor">
                           <path class="rocket-body" d="M12 2.5s-6 6.5-6 11c0 3 2.5 5.5 6 5.5s6-2.5 6-5.5c0-4.5-6-11-6-11z" fill="#E0E0E0"/>
                           <path class="rocket-window" d="M12 9a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z" fill="#3B82F6"/>
                           <path class="rocket-fins" d="M5.5 14L2 19h5l1-2.5M18.5 14L22 19h-5l-1-2.5" fill="#FF5722"/>
                           <path class="rocket-fire" d="M12 20s-1.5 1.5-1.5 3 .5 1 1.5 1 1.5.5 1.5-1-1.5-3-1.5-3z" fill="#FFC107"/>
                        </svg>
                    </span>
                    <span id="logoName"></span>
                </a>
                
                <div class="header-actions">
                    <a href="index.html" class="btn btn-secondary">
                        <span style="display:flex; align-items:center;">
                             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                        </span>
                        <span>ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸÇÿßÿ¶ŸÖÿ©</span>
                    </a>
                    <a href="cart.html" class="cart-btn">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        </span>
                        <span>ÿßŸÑÿ≥ŸÑÿ©</span>
                        <span class="cart-count" style="display: none;">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- My Orders Page -->
    <main class="cart-page">
        <div class="container">
            <h1 class="fade-in mb-3">
                <span style="display:inline-flex; align-items:center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                </span> ÿ∑ŸÑÿ®ÿßÿ™Ÿä
            </h1>
            
            <!-- Phone Search -->
            <div id="phoneSearch" class="fade-in fade-in-delay-1" style="margin: 0 auto 2rem;">
                <div class="phone-search-card">
                    <div class="phone-search-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 100 100" fill="none">
                            <defs>
                                <linearGradient id="phoneGrad" x1="20" y1="10" x2="80" y2="90" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#4F46E5"/>
                                    <stop offset="1" stop-color="#9333EA"/>
                                </linearGradient>
                                <linearGradient id="screenGrad" x1="25" y1="15" x2="75" y2="85" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#EFF6FF"/>
                                    <stop offset="1" stop-color="#DBEAFE"/>
                                </linearGradient>
                                <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                                    <feGaussianBlur stdDeviation="3" result="blur"/>
                                    <feComposite in="SourceGraphic" in2="blur" operator="over"/>
                                </filter>
                            </defs>
                            <!-- Phone Body with Gradient -->
                            <rect x="25" y="10" width="50" height="80" rx="6" fill="url(#phoneGrad)" stroke="#312E81" stroke-width="2"/>
                            <!-- Screen -->
                            <rect x="29" y="18" width="42" height="58" rx="2" fill="url(#screenGrad)"/>
                            <!-- Top Bar (Speaker) -->
                            <rect x="42" y="13.5" width="16" height="2" rx="1" fill="#E0E7FF" opacity="0.8"/>
                            <!-- Bottom Button -->
                            <circle cx="50" cy="83" r="3" fill="#E0E7FF" opacity="0.8"/>
                            
                            <!-- Apps/Icons on Screen -->
                            <rect x="33" y="24" width="8" height="8" rx="2" fill="#F472B6"/>
                            <rect x="46" y="24" width="8" height="8" rx="2" fill="#34D399"/>
                            <rect x="59" y="24" width="8" height="8" rx="2" fill="#FBBF24"/>
                            
                            <rect x="33" y="36" width="34" height="2" rx="1" fill="#BFDBFE"/>
                            <rect x="33" y="42" width="28" height="2" rx="1" fill="#BFDBFE"/>
                            
                            <!-- Search Magnifier (Pop-out effect) -->
                            <g filter="url(#glow)">
                                <circle cx="58" cy="58" r="14" fill="#F97316" stroke="white" stroke-width="3"/>
                                <circle cx="58" cy="58" r="6" stroke="white" stroke-width="2.5" fill="none"/>
                                <line x1="63" y1="63" x2="68" y2="68" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
                            </g>
                        </svg>
                    </div>
                    <h3 class="mb-2">ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ Ÿáÿßÿ™ŸÅŸÉ</h3>
                    <p class="text-muted mb-3">ŸÑÿπÿ±ÿ∂ ÿ∑ŸÑÿ®ÿßÿ™ŸÉ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©</p>
                    
                    <form onsubmit="searchOrders(event)">
                        <div class="form-group">
                            <input type="tel" class="form-input" id="searchPhone" required
                                   placeholder="0X XX XX XX XX" pattern="0[5-7][0-9]{8}"
                                   style="text-align: center; font-size: 1.25rem; direction: ltr;">
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg btn-block">
                            <span style="display:inline-flex; align-items:center;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            </span> ÿπÿ±ÿ∂ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Orders List -->
            <div id="ordersSection" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 id="ordersTitle">ÿ∑ŸÑÿ®ÿßÿ™ŸÉ</h2>
                    <button class="btn btn-secondary" onclick="showPhoneSearch()">
                        <span style="display:inline-flex; align-items:center;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        </span> ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ±ŸÇŸÖ
                    </button>
                </div>
                
                <div id="ordersList" class="orders-list">
                    <!-- Orders will be loaded here -->
                </div>
            </div>
        </div>
    </main>



    <!-- Rating Modal -->
    <div class="modal-overlay" id="ratingModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:#FFD700; margin-left:8px; vertical-align:middle;"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                    ŸÇŸäŸëŸÖ ÿ∑ŸÑÿ®ŸÉ
                </h3>
                <button class="modal-close" onclick="closeRatingModal()">‚úï</button>
            </div>
            <div class="modal-body" style="text-align: center;">
                <p style="margin-bottom: 1.5rem;">ŸÉŸäŸÅ ŸÉÿßŸÜÿ™ ÿ™ÿ¨ÿ±ÿ®ÿ™ŸÉ ŸÖÿπ Ÿáÿ∞ÿß ÿßŸÑÿ∑ŸÑÿ®ÿü</p>
                
                <div class="stars-rating" id="starsContainer" style="justify-content: center; margin-bottom: 2rem;">
                    <span class="star" data-rating="1" onclick="selectRating(1)">‚òÖ</span>
                    <span class="star" data-rating="2" onclick="selectRating(2)">‚òÖ</span>
                    <span class="star" data-rating="3" onclick="selectRating(3)">‚òÖ</span>
                    <span class="star" data-rating="4" onclick="selectRating(4)">‚òÖ</span>
                    <span class="star" data-rating="5" onclick="selectRating(5)">‚òÖ</span>
                </div>
                
                <div class="form-group">
                    <textarea class="form-textarea" id="reviewText" rows="3"
                              placeholder="ÿßŸÉÿ™ÿ® ÿ™ÿπŸÑŸäŸÇŸÉ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRatingModal()">ÿ•ŸÑÿ∫ÿßÿ°</button>
                <button class="btn btn-primary" onclick="submitRating()">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div class="modal-overlay" id="detailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®</h3>
                <button class="modal-close" onclick="closeDetailsModal()">‚úï</button>
            </div>
            <div class="modal-body" id="detailsModalBody">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/api-client.js"></script>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/orders.js"></script>
    <script>
        let currentOrderId = null;
        let selectedRating = 0;
        let currentPhone = '';
        
        let pollInterval;
        let lastRenderedSignature = ''; // To prevent unnecessary re-renders

        document.addEventListener('DOMContentLoaded', async () => {
            // Load app data including settings AND ORDERS
            if (typeof initializeApp === 'function') {
                await initializeApp(); 
            } else if (typeof loadRestaurantSettings === 'function') {
                loadRestaurantSettings();
            }

            // EXPLICIT REFRESH: Fix for "New orders not appearing"
            if (typeof refreshOrders === 'function') {
                await refreshOrders();
            }

            // SMART LISTENER: Only re-render if data actually changed
            document.addEventListener('orders-updated', () => {
               if (currentPhone) {
                   const orders = getCustomerOrders(currentPhone);
                   
                   // Create a signature of the current state (IDs + Statuses)
                   // "1:new|2:preparing"
                   const newSignature = orders.map(o => `${o.id}:${o.status}:${o.total}`).join('|');
                   
                   // Compare with last rendered state
                   if (newSignature !== lastRenderedSignature) {
                       console.log('Status change detected! Updating UI...');
                       renderOrders(orders);
                       lastRenderedSignature = newSignature;
                   }
               }
            });
            
            updateCartUI();
            
            // Check if phone was saved
            const savedPhone = localStorage.getItem('customerPhone');
            if (savedPhone) {
                document.getElementById('searchPhone').value = savedPhone;
                // Auto-search if valid
                if (savedPhone.length >= 10) {
                     setTimeout(() => document.querySelector('form').dispatchEvent(new Event('submit')), 300);
                }
            }
        });
        
        async function searchOrders(e) {
            e.preventDefault();
            
            const phone = document.getElementById('searchPhone').value.trim();
            
            if (!validatePhone(phone)) {
                showToast('ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠', 'error');
                return;
            }
            
            currentPhone = phone;
            localStorage.setItem('customerPhone', phone);
            
            // Show loading
            const btn = e.target.querySelector('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ®ÿ≠ÿ´...';
            btn.disabled = true;

            try {
                // Force fresh fetch on search
                if (typeof refreshOrders === 'function') {
                    await refreshOrders();
                }

                const orders = getCustomerOrders(phone);
                
                if (orders.length === 0) {
                    showToast('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ŸÑŸáÿ∞ÿß ÿßŸÑÿ±ŸÇŸÖ', 'info');
                } else {
                    document.getElementById('phoneSearch').style.display = 'none';
                    document.getElementById('ordersSection').style.display = 'block';
                    document.getElementById('ordersTitle').textContent = `ÿ∑ŸÑÿ®ÿßÿ™ŸÉ (${orders.length})`;
                    
                    // Initial Render
                    renderOrders(orders);
                    lastRenderedSignature = orders.map(o => `${o.id}:${o.status}:${o.total}`).join('|');
                    
                    // START SMART CHECKING (Background)
                    startPolling();
                }
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        
        function startPolling() {
            // Polling is now handled globally by data.js using SSE (Realtime)
            console.log('Using Global Realtime Updates');
        }

        function showPhoneSearch() {
            document.getElementById('phoneSearch').style.display = 'block';
            document.getElementById('ordersSection').style.display = 'none';
            if (pollInterval) clearInterval(pollInterval);
        }
        
        function renderOrders(orders) {
            const container = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                 container.innerHTML = '<div style="text-align:center; padding:20px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™</div>';
                 return;
            }
            // Update global signature just in case called directly
            lastRenderedSignature = orders.map(o => `${o.id}:${o.status}:${o.total}`).join('|');
            
            container.innerHTML = orders.map((order, index) => {
                const itemsCount = order.items.reduce((sum, i) => sum + i.quantity, 0);

                return `
                <div class="order-card fade-in" style="animation-delay: ${index * 0.1}s;">
                    <div class="order-card-header">
                        <div>
                            <h3 class="order-number">${order.orderNumber}</h3>
                            <span class="order-date">${formatDateTime(order.createdAt)}</span>
                        </div>
                        <span class="order-status-badge" style="background: ${getStatusColor(order.status)}15; color: ${getStatusColor(order.status)}; border: 1px solid ${getStatusColor(order.status)}40;">
                            ${getStatusText(order.status)}
                        </span>
                    </div>
                    
                    <div class="order-card-body">
                        <p style="color: var(--text-secondary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 6px;">
                            ${order.orderType === 'delivery' ? 
                                '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg> ÿ™ŸàÿµŸäŸÑ' : 
                                '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21h18"></path><path d="M5 21V7l8-4 8 4v14"></path><path d="M17 21v-8.5a1.5 1.5 0 0 0-1.5-1.5h-7a1.5 1.5 0 0 0-1.5 1.5V21"></path></svg> ÿ≠ÿ∂Ÿàÿ±'}
                            ${order.address ? ` - ${order.address.substring(0, 50)}...` : ''}
                        </p>
                        
                         <!-- Count Display Only -->
                        <div style="font-weight: 600; color: var(--text-primary); display: flex; align-items: center; justify-content: space-between;">
                            <span style="display:inline-flex; align-items:center;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left:4px;"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg> 
                                ÿπÿØÿØ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™: ${itemsCount}
                            </span>
                            <button class="btn btn-sm btn-secondary" onclick="openDetailsModal('${order.id}')" style="padding: 4px 12px; font-size: 0.85rem;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle; margin-left:4px;"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg> ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                            </button>
                        </div>
                    </div>
                    
                    <div class="order-card-footer">
                        <div class="order-total">${formatPrice(order.total)}</div>
                        
                        <div class="order-actions">
                            ${order.status === 'delivered' && !order.rating ? `
                                <button class="btn btn-secondary" onclick="openRatingModal('${order.id}')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:#FFD700;"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg> ŸÇŸäŸëŸÖ
                                </button>
                            ` : ''}
                            ${order.rating ? `
                                <span style="color: var(--gold);">${'‚òÖ'.repeat(order.rating)}${'‚òÜ'.repeat(5 - order.rating)}</span>
                            ` : ''}


                        </div>
                    </div>
                </div>
            `}).join('');
        }
        


        
        function openRatingModal(orderId) {
            currentOrderId = orderId;
            selectedRating = 0;
            document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
            document.getElementById('reviewText').value = '';
            document.getElementById('ratingModal').classList.add('active');
        }
        
        function closeRatingModal() {
            document.getElementById('ratingModal').classList.remove('active');
            currentOrderId = null;
        }
        
        function selectRating(rating) {
            selectedRating = rating;
            document.querySelectorAll('.star').forEach(star => {
                const starRating = parseInt(star.dataset.rating);
                star.classList.toggle('active', starRating <= rating);
            });
        }
        
        async function submitRating() {
            if (selectedRating === 0) {
                showToast('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿ™ŸÇŸäŸäŸÖ', 'warning');
                return;
            }
            
            const review = document.getElementById('reviewText').value.trim();
            const btn = document.querySelector('#ratingModal .btn-primary');
            const originalText = btn.textContent;
            btn.textContent = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ...';
            btn.disabled = true;
            
            try {
                const success = await rateOrder(currentOrderId, selectedRating, review);
                if (success) {
                    closeRatingModal();
                    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÑÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑÿ™ŸÇŸäŸäŸÖ
                    const orders = getCustomerOrders(currentPhone);
                    renderOrders(orders);
                } else {
                    showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ', 'error');
                }
            } catch (e) {
                console.error(e);
                showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπ', 'error');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }
        
        function openDetailsModal(orderId) {
            const orders = getCustomerOrders(currentPhone);
            const order = orders.find(o => o.id == orderId);
            
            if (!order) return;
            
            const modalBody = document.getElementById('detailsModalBody');
            
            const itemsHtml = order.items.map(item => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 40px; height: 40px; border-radius: 8px; overflow: hidden; flex-shrink: 0;">
                            ${window.getMealImageOrPlaceholder ? window.getMealImageOrPlaceholder(item, 'width: 100%; height: 100%;', 'width: 100%; height: 100%; object-fit: cover;') : ''}
                        </div>
                        <div>
                            <span style="font-weight: bold;">${item.quantity}x</span> ${item.name}
                            ${item.sizeName ? `<div style="font-size: 0.85rem; color: gray;">${item.sizeName}</div>` : ''}
                        </div>
                    </div>
                    <div style="font-weight: bold;">${formatPrice(item.price * item.quantity)}</div>
                </div>
            `).join('');
            
            modalBody.innerHTML = `
                <div style="text-align: right;">
                    ${itemsHtml}
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #eee; display: flex; justify-content: space-between; font-weight: 900; font-size: 1.1rem;">
                        <span>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</span>
                        <span>${formatPrice(order.total)}</span>
                    </div>
                    ${order.notes ? `<div style="margin-top: 10px; background: #fff3cd; padding: 10px; border-radius: 8px; font-size: 0.9rem;">üìù ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™: ${order.notes}</div>` : ''}
                </div>
            `;
            
            document.getElementById('detailsModal').classList.add('active');
        }
        
        function closeDetailsModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }
    </script>
    

</body>
</html>
