<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©">
    <meta name="theme-color" content="#f97316">
    <title id="pageTitle">Ø·Ù„Ø¨Ø§ØªÙŠ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/client-premium.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“‹</text></svg>">
</head>
<body class="cp-page">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <span class="logo-icon rocket-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="currentColor">
                           <path class="rocket-body" d="M12 2.5s-6 6.5-6 11c0 3 2.5 5.5 6 5.5s6-2.5 6-5.5c0-4.5-6-11-6-11z" fill="#E0E0E0"/>
                           <path class="rocket-window" d="M12 9a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z" fill="#3B82F6"/>
                           <path class="rocket-fins" d="M5.5 14L2 19h5l1-2.5M18.5 14L22 19h-5l-1-2.5" fill="#FF5722"/>
                           <path class="rocket-fire" d="M12 20s-1.5 1.5-1.5 3 .5 1 1.5 1 1.5.5 1.5-1-1.5-3-1.5-3z" fill="#FFC107"/>
                        </svg>
                    </span>
                    <span id="logoName"></span>
                </a>
                
                <div class="header-actions">
                    <a href="index.html" class="cp-btn cp-btn-secondary" style="padding: 10px 20px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                        <span>Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
                    </a>
                    <a href="cart.html" class="cart-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        <span>Ø§Ù„Ø³Ù„Ø©</span>
                        <span class="cart-count" style="display: none;">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- My Orders Page -->
    <main class="cp-main">
        <div class="cp-container">
            <!-- Page Title -->
            <h1 class="cp-page-title cp-fade-in">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                Ø·Ù„Ø¨Ø§ØªÙŠ
            </h1>
            
            <!-- Phone Search -->
            <div id="phoneSearch" class="cp-fade-in cp-delay-1">
                <div class="cp-card cp-phone-search">
                    <div class="cp-phone-search-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 100 100" fill="none">
                            <defs>
                                <linearGradient id="phoneGrad" x1="20" y1="10" x2="80" y2="90" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#f97316"/>
                                    <stop offset="1" stop-color="#ea580c"/>
                                </linearGradient>
                                <linearGradient id="screenGrad" x1="25" y1="15" x2="75" y2="85" gradientUnits="userSpaceOnUse">
                                    <stop stop-color="#fff7ed"/>
                                    <stop offset="1" stop-color="#ffedd5"/>
                                </linearGradient>
                            </defs>
                            <!-- Phone Body -->
                            <rect x="25" y="10" width="50" height="80" rx="6" fill="url(#phoneGrad)" stroke="#c2410c" stroke-width="2"/>
                            <!-- Screen -->
                            <rect x="29" y="18" width="42" height="58" rx="2" fill="url(#screenGrad)"/>
                            <!-- Top Bar -->
                            <rect x="42" y="13.5" width="16" height="2" rx="1" fill="#fff7ed" opacity="0.8"/>
                            <!-- Bottom Button -->
                            <circle cx="50" cy="83" r="3" fill="#fff7ed" opacity="0.8"/>
                            <!-- Apps -->
                            <rect x="33" y="24" width="8" height="8" rx="2" fill="#fb923c"/>
                            <rect x="46" y="24" width="8" height="8" rx="2" fill="#22c55e"/>
                            <rect x="59" y="24" width="8" height="8" rx="2" fill="#3b82f6"/>
                            <!-- Lines -->
                            <rect x="33" y="36" width="34" height="2" rx="1" fill="#fed7aa"/>
                            <rect x="33" y="42" width="28" height="2" rx="1" fill="#fed7aa"/>
                            <!-- Search Icon -->
                            <circle cx="58" cy="58" r="14" fill="white" stroke="#f97316" stroke-width="3"/>
                            <circle cx="58" cy="58" r="6" stroke="#f97316" stroke-width="2.5" fill="none"/>
                            <line x1="63" y1="63" x2="68" y2="68" stroke="#f97316" stroke-width="3.5" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ</h3>
                    <p>Ù„Ø¹Ø±Ø¶ Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</p>
                    
                    <form onsubmit="searchOrders(event)">
                        <div class="cp-input-group">
                            <input type="tel" class="cp-input cp-phone-input" id="searchPhone" required placeholder="0X XX XX XX XX" pattern="0[5-7][0-9]{8}">
                        </div>
                        <button type="submit" class="cp-btn cp-btn-primary cp-btn-lg cp-btn-block">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Orders List -->
            <div id="ordersSection" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;" class="cp-fade-in">
                    <h2 id="ordersTitle" style="margin: 0; font-size: 1.3rem; font-weight: 800; color: var(--cp-gray-900);">Ø·Ù„Ø¨Ø§ØªÙƒ</h2>
                    <button class="cp-btn cp-btn-ghost" onclick="showPhoneSearch()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ù‚Ù…
                    </button>
                </div>
                
                <div id="ordersList">
                    <!-- Orders will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="cp-footer">
        <div class="cp-container">
            <p>Â© 2026 Ù…Ø·Ø¹Ù…ÙŠ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
        </div>
    </footer>

    <!-- Rating Modal -->
    <div class="cp-modal-overlay" id="ratingModal">
        <div class="cp-modal">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#fbbf24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                    Ù‚ÙŠÙ‘Ù… Ø·Ù„Ø¨Ùƒ
                </h3>
                <button class="cp-modal-close" onclick="closeRatingModal()">âœ•</button>
            </div>
            <div class="cp-modal-body" style="text-align: center;">
                <p style="margin-bottom: 24px; color: var(--cp-gray-600);">ÙƒÙŠÙ ÙƒØ§Ù†Øª ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ</p>
                
                <div class="cp-stars" id="starsContainer" style="margin-bottom: 28px;">
                    <span class="cp-star" data-rating="1" onclick="selectRating(1)">â˜…</span>
                    <span class="cp-star" data-rating="2" onclick="selectRating(2)">â˜…</span>
                    <span class="cp-star" data-rating="3" onclick="selectRating(3)">â˜…</span>
                    <span class="cp-star" data-rating="4" onclick="selectRating(4)">â˜…</span>
                    <span class="cp-star" data-rating="5" onclick="selectRating(5)">â˜…</span>
                </div>
                
                <div class="cp-input-group">
                    <textarea class="cp-input cp-textarea" id="reviewText" rows="3" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)..."></textarea>
                </div>
            </div>
            <div class="cp-modal-footer">
                <button class="cp-btn cp-btn-secondary" onclick="closeRatingModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="cp-btn cp-btn-primary" onclick="submitRating()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</button>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div class="cp-modal-overlay" id="detailsModal">
        <div class="cp-modal">
            <div class="cp-modal-header">
                <h3 class="cp-modal-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--cp-orange-500)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
                </h3>
                <button class="cp-modal-close" onclick="closeDetailsModal()">âœ•</button>
            </div>
            <div class="cp-modal-body" id="detailsModalBody">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/api-client.js"></script>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/app.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/orders.js"></script>
    <script>
        let currentOrderId = null;
        let selectedRating = 0;
        let currentPhone = '';
        
        let pollInterval;
        let lastRenderedSignature = '';

        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof initializeApp === 'function') {
                await initializeApp(); 
            } else if (typeof loadRestaurantSettings === 'function') {
                loadRestaurantSettings();
            }

            if (typeof refreshOrders === 'function') {
                await refreshOrders();
            }

            document.addEventListener('orders-updated', () => {
               if (currentPhone) {
                   const orders = getCustomerOrders(currentPhone);
                   const newSignature = orders.map(o => `${o.id}:${o.status}:${o.total}`).join('|');
                   
                   if (newSignature !== lastRenderedSignature) {
                       console.log('Status change detected! Updating UI...');
                       renderOrders(orders);
                       lastRenderedSignature = newSignature;
                   }
               }
            });
            
            updateCartUI();
            
            const savedPhone = localStorage.getItem('customerPhone');
            if (savedPhone) {
                document.getElementById('searchPhone').value = savedPhone;
                if (savedPhone.length >= 10) {
                     setTimeout(() => document.querySelector('form').dispatchEvent(new Event('submit')), 300);
                }
            }
        });
        
        async function searchOrders(e) {
            e.preventDefault();
            
            const phone = document.getElementById('searchPhone').value.trim();
            
            if (!validatePhone(phone)) {
                showToast('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                return;
            }
            
            currentPhone = phone;
            localStorage.setItem('customerPhone', phone);
            
            const btn = e.target.querySelector('button');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="cp-spinner" style="width: 20px; height: 20px; border-width: 2px;"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
            btn.disabled = true;

            try {
                if (typeof refreshOrders === 'function') {
                    await refreshOrders();
                }

                const orders = getCustomerOrders(phone);
                
                if (orders.length === 0) {
                    showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…', 'info');
                } else {
                    document.getElementById('phoneSearch').style.display = 'none';
                    document.getElementById('ordersSection').style.display = 'block';
                    document.getElementById('ordersTitle').textContent = `Ø·Ù„Ø¨Ø§ØªÙƒ (${orders.length})`;
                    
                    renderOrders(orders);
                    lastRenderedSignature = orders.map(o => `${o.id}:${o.status}:${o.total}`).join('|');
                    
                    startPolling();
                }
            } finally {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
            }
        }
        
        function startPolling() {
            console.log('Using Global Realtime Updates');
        }

        function showPhoneSearch() {
            document.getElementById('phoneSearch').style.display = 'block';
            document.getElementById('ordersSection').style.display = 'none';
            if (pollInterval) clearInterval(pollInterval);
        }
        
        function renderOrders(orders) {
            const container = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                 container.innerHTML = `
                    <div class="cp-card cp-empty">
                        <div class="cp-empty-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                        </div>
                        <h2 class="cp-empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</h2>
                        <p class="cp-empty-desc">Ù„Ù… ØªÙ‚Ù… Ø¨Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯</p>
                    </div>
                 `;
                 return;
            }
            
            lastRenderedSignature = orders.map(o => `${o.id}:${o.status}:${o.total}`).join('|');
            
            container.innerHTML = orders.map((order, index) => {
                const itemsCount = order.items.reduce((sum, i) => sum + i.quantity, 0);

                return `
                <div class="cp-order-card cp-fade-in" style="animation-delay: ${index * 0.1}s;">
                    <div class="cp-order-header">
                        <div>
                            <h3 class="cp-order-number">${order.orderNumber}</h3>
                            <span class="cp-order-date">${formatDateTime(order.createdAt)}</span>
                        </div>
                        <span class="cp-order-status ${order.status}">
                            ${getStatusIcon(order.status)} ${getStatusText(order.status)}
                        </span>
                    </div>
                    
                    <div class="cp-order-body">
                        <p class="cp-order-type">
                            ${order.orderType === 'delivery' ? 
                                '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg> ØªÙˆØµÙŠÙ„' : 
                                '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21h18"></path><path d="M5 21V7l8-4 8 4v14"></path></svg> Ø­Ø¶ÙˆØ±'}
                            ${order.address ? ` - ${order.address.substring(0, 40)}...` : ''}
                        </p>
                        
                        <div class="cp-order-items-count">
                            <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
                                Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${itemsCount}
                            </span>
                            <button class="cp-btn cp-btn-ghost" onclick="openDetailsModal('${order.id}')" style="padding: 8px 16px; font-size: 0.85rem;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                        </div>
                    </div>
                    
                    <div class="cp-order-footer">
                        <div class="cp-order-total">${formatPrice(order.total)}</div>
                        
                        <div class="cp-order-actions">
                            ${order.status === 'delivered' && !order.rating ? `
                                <button class="cp-btn cp-btn-secondary" onclick="openRatingModal('${order.id}')" style="padding: 8px 16px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#fbbf24" stroke="#fbbf24" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                                    Ù‚ÙŠÙ‘Ù…
                                </button>
                            ` : ''}
                            ${order.rating ? `
                                <span style="color: #fbbf24; font-size: 1.2rem;">${'â˜…'.repeat(order.rating)}${'â˜†'.repeat(5 - order.rating)}</span>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
        }
        
        function getStatusIcon(status) {
            const icons = {
                'new': 'ğŸ†•',
                'preparing': 'ğŸ‘¨â€ğŸ³',
                'ready': 'ğŸ“¦',
                'onTheWay': 'ğŸ›µ',
                'delivered': 'âœ…',
                'cancelled': 'âŒ'
            };
            return icons[status] || 'ğŸ“‹';
        }

        function openRatingModal(orderId) {
            currentOrderId = orderId;
            selectedRating = 0;
            document.querySelectorAll('.cp-star').forEach(star => star.classList.remove('active'));
            document.getElementById('reviewText').value = '';
            document.getElementById('ratingModal').classList.add('active');
        }
        
        function closeRatingModal() {
            document.getElementById('ratingModal').classList.remove('active');
            currentOrderId = null;
        }
        
        function selectRating(rating) {
            selectedRating = rating;
            document.querySelectorAll('.cp-star').forEach(star => {
                const starRating = parseInt(star.dataset.rating);
                star.classList.toggle('active', starRating <= rating);
            });
        }
        
        async function submitRating() {
            if (selectedRating === 0) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØªÙ‚ÙŠÙŠÙ…', 'warning');
                return;
            }
            
            const review = document.getElementById('reviewText').value.trim();
            const btn = document.querySelector('#ratingModal .cp-btn-primary');
            const originalText = btn.textContent;
            btn.innerHTML = '<div class="cp-spinner" style="width: 18px; height: 18px; border-width: 2px;"></div>';
            btn.disabled = true;
            
            try {
                const success = await rateOrder(currentOrderId, selectedRating, review);
                if (success) {
                    closeRatingModal();
                    const orders = getCustomerOrders(currentPhone);
                    renderOrders(orders);
                    showToast('Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ!', 'success');
                } else {
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…', 'error');
                }
            } catch (e) {
                console.error(e);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹', 'error');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }
        
        function openDetailsModal(orderId) {
            const orders = getCustomerOrders(currentPhone);
            const order = orders.find(o => o.id == orderId);
            
            if (!order) return;
            
            const modalBody = document.getElementById('detailsModalBody');
            
            const itemsHtml = order.items.map(item => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px dashed var(--cp-gray-200);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 45px; height: 45px; border-radius: 10px; overflow: hidden; flex-shrink: 0; background: var(--cp-gray-100);">
                            ${window.getMealImageOrPlaceholder ? window.getMealImageOrPlaceholder(item, 'width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;', 'width: 100%; height: 100%; object-fit: cover;') : '<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">ğŸ½ï¸</div>'}
                        </div>
                        <div>
                            <span style="font-weight: 700; color: var(--cp-gray-800);">${item.quantity}x</span> ${item.name}
                            ${item.sizeName ? `<div style="font-size: 0.85rem; color: var(--cp-gray-500);">${item.sizeName}</div>` : ''}
                        </div>
                    </div>
                    <div style="font-weight: 800; color: var(--cp-orange-600);">${formatPrice(item.price * item.quantity)}</div>
                </div>
            `).join('');
            
            modalBody.innerHTML = `
                <div style="text-align: right;">
                    ${itemsHtml}
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--cp-gray-200); display: flex; justify-content: space-between; font-weight: 900; font-size: 1.2rem;">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                        <span style="color: var(--cp-orange-600);">${formatPrice(order.total)}</span>
                    </div>
                    ${order.notes ? `
                        <div style="margin-top: 16px; background: #fef3c7; padding: 12px 16px; border-radius: 12px; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                            <span>ğŸ“</span> Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${order.notes}
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('detailsModal').classList.add('active');
        }
        
        function closeDetailsModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }
    </script>
    

</body>
</html>
